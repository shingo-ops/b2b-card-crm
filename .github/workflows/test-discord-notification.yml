# Discordé€šçŸ¥ãƒ†ã‚¹ãƒˆç”¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
# æ‰‹å‹•å®Ÿè¡Œã§Discordé€šçŸ¥ã‚’ãƒ†ã‚¹ãƒˆ

name: Test Discord Notification

on:
  workflow_dispatch:
    inputs:
      test_type:
        description: 'ãƒ†ã‚¹ãƒˆã‚¿ã‚¤ãƒ—'
        required: true
        default: 'both'
        type: choice
        options:
          - bugreport
          - request
          - both

jobs:
  test-bugreport-notification:
    name: Test Bugreport Channel
    runs-on: ubuntu-latest
    if: ${{ github.event.inputs.test_type == 'bugreport' || github.event.inputs.test_type == 'both' }}

    steps:
      - name: Send test notification to Bugreport channel
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_BUGREPORT_WEBHOOK }}
        run: |
          if [ -z "$DISCORD_WEBHOOK" ]; then
            echo "âŒ DISCORD_BUGREPORT_WEBHOOK ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“"
            exit 1
          fi

          curl -s -H "Content-Type: application/json" \
            -d "{
              \"content\": \"ğŸ§ª **ãƒ†ã‚¹ãƒˆé€šçŸ¥ï¼ˆãƒã‚°å ±å‘Šãƒãƒ£ãƒ³ãƒãƒ«ï¼‰**\n\nâœ… GitHub Actionsã‹ã‚‰ã®é€šçŸ¥ãƒ†ã‚¹ãƒˆã§ã™\nğŸ“… $(date '+%Y-%m-%d %H:%M:%S')\nğŸ”— å®Ÿè¡Œè€…: ${{ github.actor }}\"
            }" \
            "$DISCORD_WEBHOOK"

          echo "âœ… ãƒã‚°å ±å‘Šãƒãƒ£ãƒ³ãƒãƒ«ã¸ã®é€šçŸ¥ã‚’é€ä¿¡ã—ã¾ã—ãŸ"

  test-request-notification:
    name: Test Request Channel
    runs-on: ubuntu-latest
    if: ${{ github.event.inputs.test_type == 'request' || github.event.inputs.test_type == 'both' }}

    steps:
      - name: Send test notification to Request channel
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_REQUEST_WEBHOOK }}
        run: |
          if [ -z "$DISCORD_WEBHOOK" ]; then
            echo "âŒ DISCORD_REQUEST_WEBHOOK ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“"
            exit 1
          fi

          curl -s -H "Content-Type: application/json" \
            -d "{
              \"content\": \"ğŸ§ª **ãƒ†ã‚¹ãƒˆé€šçŸ¥ï¼ˆä¾é ¼ãƒãƒ£ãƒ³ãƒãƒ«ï¼‰**\n\nâœ… GitHub Actionsã‹ã‚‰ã®é€šçŸ¥ãƒ†ã‚¹ãƒˆã§ã™\nğŸ“… $(date '+%Y-%m-%d %H:%M:%S')\nğŸ”— å®Ÿè¡Œè€…: ${{ github.actor }}\"
            }" \
            "$DISCORD_WEBHOOK"

          echo "âœ… ä¾é ¼ãƒãƒ£ãƒ³ãƒãƒ«ã¸ã®é€šçŸ¥ã‚’é€ä¿¡ã—ã¾ã—ãŸ"

  test-error-format:
    name: Test Error Format
    runs-on: ubuntu-latest
    if: ${{ github.event.inputs.test_type == 'bugreport' || github.event.inputs.test_type == 'both' }}

    steps:
      - name: Send error format notification
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_BUGREPORT_WEBHOOK }}
        run: |
          if [ -z "$DISCORD_WEBHOOK" ]; then
            echo "âš ï¸ DISCORD_BUGREPORT_WEBHOOK ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼ˆã‚¹ã‚­ãƒƒãƒ—ï¼‰"
            exit 0
          fi

          curl -s -H "Content-Type: application/json" \
            -d "{
              \"content\": \"ğŸš¨ **ç•°å¸¸æ¤œçŸ¥ï¼ˆãƒ†ã‚¹ãƒˆï¼‰**\n\nâŒ **å¤±æ•—ã—ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**: Security Check\nğŸ“… **ç™ºç”Ÿæ—¥æ™‚**: $(date '+%Y-%m-%d %H:%M:%S')\nğŸ”— **è©³ç´°**: https://github.com/${{ github.repository }}/actions\n\nğŸ‘‰ **å¯¾å¿œä¾é ¼**: Claude Codeã§ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„\n\`\`\`\ncd ~/sales-ops-with-claude && git pull\n\`\`\`\n\nâš ï¸ ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆé€šçŸ¥ã§ã™\"
            }" \
            "$DISCORD_WEBHOOK"

          echo "âœ… ã‚¨ãƒ©ãƒ¼å½¢å¼ã®é€šçŸ¥ã‚’é€ä¿¡ã—ã¾ã—ãŸ"
