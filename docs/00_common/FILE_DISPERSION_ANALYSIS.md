# FILE_DISPERSION_ANALYSIS.md - ファイル分散問題の要因分析レポート

> **作成日**: 2026-01-17
> **目的**: ファイル分散の真因分析と最適化の判断材料提供
> **用途**: TROUBLE_LOG.md記録用

---

## 1. 問題の概要

### 1.1 現状把握（5W2H）

| 項目 | 内容 |
|------|------|
| いつ | 2025-01-11〜2026-01-17（約2ヶ月間） |
| どこで | /docs/配下全体 |
| 誰が | Claude Code（開発者） |
| 何が | ファイルが98件に分散し、把握困難な状態 |
| どうやって | 新機能追加のたびに新規ファイルを作成し続けた |
| どれぐらい | 98ファイル（適正値の約2倍） |
| なぜ | ファイル管理ルールが未定義だった |

### 1.2 数値データ

| 指標 | 値 |
|------|-----|
| 総ファイル数 | 98件 |
| 適正値（推定） | 50件程度 |
| 超過率 | 96% |
| 統合可能ファイル数 | 25件 |
| 不要/アーカイブ対象 | 12件 |
| 検知までの期間 | 約2ヶ月 |
| 検知方法 | Human指摘 |

---

## 2. 要因分析（なぜなぜ5回）

### 2.1 表面的原因

**ファイルが98件に分散し、どこに何があるか把握困難になった**

### 2.2 なぜなぜ分析

| # | なぜ | 回答 |
|---|------|------|
| 1 | なぜファイルが98件に増えたか | 新機能・新仕様のたびに新規ファイルを作成したから |
| 2 | なぜ新規ファイルを作成し続けたか | 既存ファイルへの追記より新規作成の方が「整理されている」と感じたから |
| 3 | なぜ「整理されている」と誤認したか | 「1機能1ファイル」が良いという暗黙の前提があったから |
| 4 | なぜその前提が生まれたか | ファイル構成の最適化基準（統合vs分離）が定義されていなかったから |
| 5 | なぜ定義されていなかったか | **ファイル管理自体がプロジェクト設計に含まれていなかったから** |

### 2.3 真因（5W2H）

| 項目 | 内容 |
|------|------|
| いつ | プロジェクト開始時（2025-01-11） |
| どこで | プロジェクト設計プロセス |
| 誰が | Claude Code + Human |
| 何を | **ファイル管理ポリシーの定義を欠落** |
| どうやって | 機能設計に注力し、ドキュメント構造設計を省略 |
| どれぐらい | プロジェクト全体に影響 |
| なぜ | 「ドキュメントは自然に整理される」という楽観的仮定 |

---

## 3. 分散パターン分析

### 3.1 分散が発生したカテゴリ

| カテゴリ | 適正数 | 実際 | 超過 | 原因 |
|---------|--------|------|------|------|
| エージェント仕様 | 2 | 8 | +6 | 属性ごとに分離 |
| 開発ログ | 2 | 5 | +3 | 種類ごとに分離 |
| CRM仕様 | 3 | 6 | +3 | 機能ごとに分離 |
| PROJECT_PROPOSALS | 2 | 9 | +7 | 完了後も保持 |
| ナレッジ | 39 | 39 | 0 | 適正（メンバー別） |

### 3.2 分散を招いた判断

| 判断 | 結果 | 適正判断 |
|------|------|----------|
| 「性格仕様は別ファイルに」 | AGENT_PERSONALITY_SPEC.md作成 | CHARACTER_SPECに統合すべき |
| 「バグ修正は別ログに」 | BUG_FIX_LOG.md作成 | DEVELOPMENT_LOGに統合すべき |
| 「提案は完了後も保持」 | 9ファイル残存 | アーカイブすべき |
| 「UIは機能別に」 | 3ファイル作成 | 1ファイルに統合すべき |

---

## 4. 最適化のメリット・デメリット・リスク

### 4.1 メリット

| # | メリット | 定量効果 |
|---|---------|----------|
| 1 | ファイル把握が容易に | 98件 → 72件（27%削減） |
| 2 | 重複情報の排除 | 推定20%の重複削除 |
| 3 | 検索・参照の効率化 | 参照時間50%短縮（推定） |
| 4 | セッション開始時のトークン消費削減 | 統合により読込行数削減 |
| 5 | メンテナンス工数削減 | 更新対象ファイル数減少 |
| 6 | 新規参加者の学習コスト低減 | 構造把握が容易に |

### 4.2 デメリット

| # | デメリット | 影響度 | 対策 |
|---|-----------|--------|------|
| 1 | 統合作業の工数 | 中 | Phase分割で段階実施 |
| 2 | 既存参照リンクの更新必要 | 中 | 一括置換で対応 |
| 3 | 統合後のファイルが大きくなる | 低 | 適切な分割基準を設定 |
| 4 | 慣れた構造の変更 | 低 | FILE_INDEX.mdで対応 |

### 4.3 リスク

| # | リスク | 発生確率 | 影響度 | 対策 |
|---|--------|----------|--------|------|
| 1 | 情報の欠落 | 中 | 高 | 統合前にバックアップ、差分確認 |
| 2 | 統合時の整合性問題 | 中 | 中 | セクション単位で統合、レビュー |
| 3 | Git履歴の複雑化 | 低 | 低 | コミットメッセージで明記 |
| 4 | 統合判断の誤り | 中 | 中 | Human承認必須 |

---

## 5. 実行しない場合のリスク

| # | リスク | 発生確率 | 影響度 |
|---|--------|----------|--------|
| 1 | さらなるファイル増加 | 高 | 高 |
| 2 | 把握困難の悪化 | 高 | 高 |
| 3 | 重複・矛盾情報の増加 | 高 | 中 |
| 4 | ルール違反の増加（参照漏れ） | 中 | 高 |
| 5 | 新規メンバーの学習コスト増大 | 高 | 中 |

---

## 6. 再発防止策

### 6.1 即時対策

| 対策 | 内容 | 効果 |
|------|------|------|
| FILE_INDEX.md運用 | 全ファイルの一元管理 | 把握困難の解消 |
| 作成時インデックス更新必須 | CLAUDE.mdに追記済み | 追跡可能性確保 |

### 6.2 恒久対策

| 対策 | 内容 | 効果 |
|------|------|------|
| ファイル作成基準の定義 | 新規vs統合の判断基準 | 分散防止 |
| 定期棚卸し | 月次でファイル数チェック | 早期検知 |
| アーカイブルール | 完了後の移動基準 | 肥大化防止 |

### 6.3 ファイル作成基準（新規定義）

**新規ファイル作成の条件**（全て満たす場合のみ）:
1. 既存ファイルに該当セクションがない
2. 500行以上の独立コンテンツがある
3. 他ファイルとの依存関係が低い
4. FILE_INDEX.mdに登録する

**既存ファイルに統合する条件**:
1. 関連するファイルが既に存在する
2. 追加内容が500行未満
3. 機能的に密結合している

---

## 7. 判断マトリクス

### 7.1 最適化実行の判断

| 条件 | 実行推奨 | 実行非推奨 |
|------|---------|-----------|
| ファイル数 | 50件超過 | 50件以下 |
| 重複率 | 10%以上 | 10%未満 |
| Human指摘 | あり | なし |
| 把握困難 | 発生 | 未発生 |

**現状**: 全条件が「実行推奨」に該当

### 7.2 推奨アクション

| Phase | 内容 | 優先度 | 工数 |
|-------|------|--------|------|
| Phase 1 | アーカイブ（12件移動） | 高 | 低 |
| Phase 2 | 統合（25件→8件） | 高 | 中 |
| Phase 3 | ナレッジフォーマット統一 | 低 | 高 |

---

## 8. 過去トラ記録用サマリー

### TROUBLE-017: ファイル分散による把握困難

**現象**: ドキュメントファイルが98件に分散し、どこに何があるか把握困難

**真因**: プロジェクト設計時にファイル管理ポリシーを定義しなかった

**影響**:
- セッション開始時の読了対象が不明確
- 重複情報の発生
- メンテナンス工数増大

**対策**:
1. FILE_INDEX.md作成（完了）
2. ファイル作成基準の定義（本レポート）
3. 最適化実行（Phase 1-3）

**再発防止**:
- ファイル作成時はFILE_INDEX.md更新必須（CLAUDE.mdに追記済み）
- 月次でファイル数チェック
- 新規vs統合の判断基準を適用

---

## 9. 結論

### 9.1 実行判断

| 判断項目 | 結果 |
|---------|------|
| メリット > デメリット | **Yes** |
| リスク許容可能 | **Yes**（対策あり） |
| 実行しないリスク > 実行リスク | **Yes** |
| **推奨** | **Phase 1から段階実行** |

### 9.2 学び

「整理のために分離する」は誤り。**統合して1箇所で管理する**方が把握しやすい。

ファイル管理もプロジェクト設計の一部として最初に定義すべき。

---

**以上**
