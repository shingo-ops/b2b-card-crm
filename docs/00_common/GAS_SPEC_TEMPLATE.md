# GAS機能仕様書テンプレート

## 概要

GAS（Google Apps Script）で新機能を開発する際の仕様書テンプレート。
機能要件と非機能要件の両方を明確にし、開発・監査・デプロイの全フェーズで参照する。

**導入日**: 2026-01-17
**参照**: TROUBLE-018（GAS非機能要件の考慮漏れによる競合状態エラー）

---

## 仕様書フォーマット

### 1. 基本情報

| 項目 | 内容 |
|------|------|
| 機能名 | |
| 担当者 | Claude Code |
| 監査者 | Gemini |
| 作成日 | YYYY-MM-DD |
| ステータス | 設計中 / 開発中 / 監査中 / 完了 |

---

### 2. 機能要件

#### 2.1 目的
- この機能が解決する課題は何か

#### 2.2 ユーザーストーリー
- 誰が（Who）
- 何をしたい（What）
- なぜ（Why）

#### 2.3 機能一覧

| # | 機能 | 説明 | 優先度 |
|---|------|------|--------|
| 1 | | | 高/中/低 |
| 2 | | | 高/中/低 |

#### 2.4 画面・UI設計
- ワイヤーフレームまたは説明

#### 2.5 データ構造

**スプレッドシート構成**
| シート名 | 目的 | 列構成 |
|---------|------|--------|
| | | |

**API関数一覧**
| 関数名 | 引数 | 戻り値 | 説明 |
|--------|------|--------|------|
| | | | |

---

### 3. 非機能要件（必須チェック）

#### 3.1 排他制御（TROUBLE-018対応）

| チェック項目 | 結果 | 備考 |
|-------------|------|------|
| insertSheet()使用箇所にLockServiceがあるか | ✅/❌ | |
| deleteSheet()使用箇所にLockServiceがあるか | ✅/❌ | |
| finally節でreleaseLock()しているか | ✅/❌ | |
| waitLockのタイムアウト設定は適切か（推奨30秒） | ✅/❌ | |

#### 3.2 GAS実行時間制限

| チェック項目 | 結果 | 備考 |
|-------------|------|------|
| 6分以内に処理が完了するか | ✅/❌ | |
| 長時間処理は分割設計されているか | ✅/❌ | |
| タイムトリガーを使用する場合、適切な間隔か | ✅/❌ | |

#### 3.3 API割り当て

| チェック項目 | 結果 | 備考 |
|-------------|------|------|
| スプレッドシートAPI呼び出し回数は適切か | ✅/❌ | |
| バッチ処理（setValues等）を活用しているか | ✅/❌ | |
| 外部API呼び出しの回数制限を考慮しているか | ✅/❌ | |

#### 3.4 トリガー制限

| チェック項目 | 結果 | 備考 |
|-------------|------|------|
| トリガー数が20個/ユーザーを超えていないか | ✅/❌ | |
| 既存トリガーとの競合がないか | ✅/❌ | |

#### 3.5 セキュリティ

| チェック項目 | 結果 | 備考 |
|-------------|------|------|
| 認証情報はスクリプトプロパティに保存しているか | ✅/❌ | |
| XSS対策（textContent使用等）をしているか | ✅/❌ | |
| CORS設定は適切か | ✅/❌ | |
| ユーザー入力のバリデーションがあるか | ✅/❌ | |

---

### 4. テスト計画

#### 4.1 単体テスト

| テストケース | 入力 | 期待結果 | 結果 |
|-------------|------|----------|------|
| | | | ✅/❌ |

#### 4.2 統合テスト

| テストケース | 条件 | 期待結果 | 結果 |
|-------------|------|----------|------|
| 複数ユーザー同時アクセス | 2ブラウザで同時に実行 | 競合状態が発生しない | ✅/❌ |

---

### 5. デプロイ計画

| 項目 | 内容 |
|------|------|
| テスト環境 | @HEAD |
| 本番デプロイID | |
| デプロイ手順 | |
| ロールバック手順 | |

---

### 6. 監査結果（Gemini記入欄）

#### 6.1 監査日時
- YYYY-MM-DD HH:MM

#### 6.2 監査結果

| 観点 | 結果 | 指摘事項 |
|------|------|----------|
| 機能要件の充足 | ✅/❌ | |
| 非機能要件の充足 | ✅/❌ | |
| セキュリティ | ✅/❌ | |
| コード品質 | ✅/❌ | |

#### 6.3 総合判定
- ✅ 承認 / ⚠️ 修正要求 / ❌ 却下

---

### 7. 承認履歴

| 日時 | 承認者 | ステータス | コメント |
|------|--------|-----------|----------|
| | Human | 設計承認 | |
| | Gemini | 監査承認 | |
| | Human | デプロイ承認 | |

---

## 使用方法

1. 新規GAS開発時、このテンプレートをコピーして使用
2. セクション1-5をClaude Codeが記入
3. Humanの設計承認を得る
4. 開発・実装
5. セクション6をGeminiが記入（監査）
6. Humanのデプロイ承認を得る
7. 本番デプロイ

## 関連ドキュメント

- CLAUDE.md セクション11「GAS排他制御ルール」
- TROUBLE-018: GAS競合状態エラー
- GAS_AUDIT_CHECKLIST.md: Gemini監査チェックリスト
